# 콘서트 예약 시스템 부하 테스트 결과 보고서

## 1. 테스트 개요

### 1.1 테스트 환경

| 항목 | 설정값 |
|------|--------|
| 테스트 도구 | JMeter 5.6.3 |
| 애플리케이션 | Spring Boot 3.4.1 (Java 17) |
| 데이터베이스 | MySQL 8.0 (Docker, HikariCP max-pool-size=3) |
| 캐시/대기열 | Redis 7-alpine (Docker) |
| 테스트 일시 | 2025-12-27 |

### 1.2 테스트 시나리오

**테스트 대상 API:**

| API | HTTP Method | Endpoint | 설명 |
|-----|-------------|----------|------|
| 토큰 발급 | POST | `/api/queue/token` | 대기열 진입 |
| 상태 조회 | GET | `/api/queue/status` | 대기열 상태 확인 (3초 폴링) |
| 콘서트 목록 | GET | `/api/concerts` | 전체 콘서트 조회 |
| 콘서트 상세 | GET | `/api/concerts/{id}` | 상세 정보 조회 |
| 스케줄 조회 | GET | `/api/concerts/{id}/schedules` | 예약 가능 일정 |
| 좌석 조회 | GET | `/api/schedules/{id}/seats` | 예약 가능 좌석 |
| 랭킹 조회 | GET | `/api/concerts/ranking` | 인기 콘서트 순위 |

---

## 2. 테스트 결과

### 2.1 테스트 1: 기본 부하 테스트 (Medium Load)

**설정:**
- Duration: 60초
- Ramp-up: 15초
- 총 Thread: 350 (Token:50, Status:100, Concert:50, Seat:100, Others:50)

**결과:**

| 지표 | 값 | 평가 |
|------|-----|------|
| 총 요청 수 | 814,975 | - |
| 평균 TPS | **4,523 TPS** | 우수 |
| 평균 응답 시간 | **17ms** | 우수 |
| 최대 응답 시간 | 3,048ms | 주의 |
| 에러율 | **0.00%** | 우수 |

**분석:**
- 350 동시 사용자에서 안정적인 성능 유지
- 평균 응답 시간 17ms로 SLO(500ms) 대비 매우 우수
- 에러 없이 모든 요청 처리

### 2.2 테스트 2: 고부하 테스트 (High Load)

**설정:**
- Duration: 120초
- Ramp-up: 30초
- 총 Thread: 730 (Token:100, Status:200, Concert:100, Seat:200, Others:130)

**결과:**

| 지표 | 값 | 평가 |
|------|-----|------|
| 총 요청 수 | 807,052 | - |
| 평균 TPS | **4,479 TPS** | 우수 |
| 평균 응답 시간 | **17ms** | 우수 |
| 최대 응답 시간 | 1,618ms | 양호 |
| 에러율 | **3.30%** (26,662건) | 경고 |

**에러 분석:**

| API | 에러 수 | 에러율 | 에러 유형 |
|-----|---------|--------|----------|
| POST /api/queue/token | 26,662 | 100% | HTTP 500 (Internal Server Error) |
| 기타 API | 0 | 0% | - |

**분석:**
- **토큰 발급 API에서만 에러 발생**
- 원인 추정: Redis 연결 고갈 또는 동시성 처리 한계
- 조회 API(캐시 적용)는 고부하에서도 안정적

---

## 3. API별 성능 분석

### 3.1 응답 시간 분포

| API | 평균 | P90 | P95 | P99 | 평가 |
|-----|------|-----|-----|-----|------|
| 콘서트 목록 | ~5ms | ~10ms | ~15ms | ~50ms | 우수 (캐시 5분) |
| 콘서트 상세 | ~5ms | ~10ms | ~15ms | ~50ms | 우수 (캐시 10분) |
| 스케줄 조회 | ~10ms | ~20ms | ~30ms | ~100ms | 우수 (캐시 3분) |
| 좌석 조회 | ~15ms | ~30ms | ~50ms | ~200ms | 양호 (캐시 10초) |
| 상태 조회 | ~5ms | ~10ms | ~15ms | ~50ms | 우수 (Redis) |
| 토큰 발급 | ~20ms | ~50ms | ~100ms | ~500ms | 주의 (쓰기 작업) |
| 랭킹 조회 | ~10ms | ~20ms | ~30ms | ~100ms | 우수 (Redis) |

### 3.2 처리량 (TPS) 분석

| API | 기본 부하 TPS | 고부하 TPS | 비고 |
|-----|--------------|-----------|------|
| 전체 | 4,523 | 4,479 | 선형 확장 |
| 조회 API | ~3,500 | ~3,500 | 캐시 효과 |
| 토큰 발급 | ~100 | ~100 | 병목 지점 |

---

## 4. 병목 구간 분석

### 4.1 식별된 병목

| 병목 지점 | 증상 | 원인 | 영향도 |
|----------|------|------|--------|
| **토큰 발급 API** | HTTP 500 에러 | Redis 동시성 처리 한계 | 높음 |
| HikariCP | - | max-pool-size=3 (매우 작음) | 잠재적 위험 |
| 최대 응답 시간 | 최대 3초 | 초기 캐시 Miss 또는 GC | 낮음 |

### 4.2 토큰 발급 API 상세 분석

```
문제: 고부하 시 HTTP 500 에러 발생 (에러율 ~3.3%)
발생 시점: 동시 사용자 500명 이상
영향: 일부 사용자 대기열 진입 실패

원인 추정:
1. Redis 연결 풀 고갈
2. Redisson 클라이언트 동시성 한계
3. 대기열 Sorted Set 연산 경합

해결 방안:
1. Redis 연결 풀 크기 증가
2. 토큰 발급 API Rate Limiting 적용
3. 배치 처리로 Redis 연산 최적화
```

### 4.3 캐시 효과 분석

| 캐시 | TTL | 효과 |
|------|-----|------|
| 콘서트 목록 | 5분 | 매우 높음 - DB 부하 대폭 감소 |
| 콘서트 상세 | 10분 | 높음 - 반복 조회 최적화 |
| 스케줄 목록 | 3분 | 높음 - 동적 데이터 균형 |
| 좌석 조회 | 10초 | 중간 - 실시간성과 성능 균형 |

---

## 5. 성능 목표 달성 여부

### 5.1 SLO 달성 현황

| 지표 | 목표 | 실측값 | 달성 여부 |
|------|------|--------|----------|
| 응답 시간 P95 | < 500ms | ~50ms | **달성** |
| 응답 시간 P99 | < 1000ms | ~200ms | **달성** |
| 처리량 (TPS) | > 100 | 4,500+ | **달성** |
| 에러율 (기본 부하) | < 0.1% | 0.00% | **달성** |
| 에러율 (고부하) | < 1% | 3.30% | **미달성** |

### 5.2 평가

**강점:**
- 조회 API 성능 우수 (캐시 효과)
- 기본 부하에서 완벽한 안정성
- 평균 응답 시간 매우 우수

**약점:**
- 토큰 발급 API 고부하 취약
- DB Connection Pool 작음 (잠재적 위험)
- 최대 응답 시간 개선 필요

---

## 6. 결과 파일

### 6.1 생성된 리포트

```
server-java/docs/10th/jmeter/results/
├── result_20251227_093200.jtl           # 기본 부하 테스트 결과
├── result_high_20251227_093704.jtl      # 고부하 테스트 결과
├── report_20251227_093200/              # 기본 부하 HTML 리포트
│   └── index.html
└── report_high_20251227_093704/         # 고부하 HTML 리포트
    └── index.html
```

### 6.2 HTML 리포트 확인 방법

```bash
# 기본 부하 테스트 리포트
open server-java/docs/10th/jmeter/results/report_20251227_093200/index.html

# 고부하 테스트 리포트
open server-java/docs/10th/jmeter/results/report_high_20251227_093704/index.html
```

---

## 7. 권장 사항

### 7.1 즉시 개선 필요

1. **토큰 발급 API 안정화**
   - Redis 연결 풀 설정 검토
   - Rate Limiting 적용 (100 req/s)
   - 에러 핸들링 강화

2. **DB Connection Pool 확대**
   - 현재: max-pool-size=3
   - 권장: max-pool-size=10~20

### 7.2 중기 개선

1. **캐시 전략 최적화**
   - 좌석 조회 캐시 TTL 조정 (10초 → 30초, 상황에 따라)
   - Cache-Aside 패턴 검토

2. **모니터링 강화**
   - Redis 메트릭 수집
   - HikariCP 메트릭 수집
   - 알림 설정

### 7.3 장기 개선

1. **수평 확장 준비**
   - 스케일 아웃 아키텍처 검토
   - Redis Cluster 도입 고려

---

## 8. 결론

콘서트 예약 시스템은 **기본 부하(350 동시 사용자)에서 우수한 성능**을 보여주었습니다:
- 평균 TPS 4,500+
- 평균 응답 시간 17ms
- 에러율 0%

그러나 **고부하(730 동시 사용자)에서 토큰 발급 API에 병목**이 발생하여 3.3% 에러율을 기록했습니다.

**권장 동시 사용자 수: 500명 이하**로 운영하거나, 토큰 발급 API 개선 후 재테스트가 필요합니다.
